<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Cognitive Bias Matcher ‚Äì Counselor Edition (v5)</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:radial-gradient(1200px 800px at 10% 10%,#7aa2ff33,transparent 60%),
                 radial-gradient(1000px 700px at 90% 20%,#e7b6ff33,transparent 60%),
                 linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      color:#1f2430;height:100vh;overflow:hidden;display:flex;align-items:center;justify-content:center;padding:10px
    }
    .container{width:98vw;height:98vh;display:flex;flex-direction:column}
    .card{background:#fff;border-radius:18px;box-shadow:0 14px 46px rgba(0,0,0,.2);padding:24px;animation:fadeIn .4s ease}

    /* Welcome */
    .welcome{height:100%;display:grid;place-items:center}
    .welcome-inner{max-width:980px}
    .welcome h1{font-size:clamp(1.6rem,3.2vw,2.6rem);color:#fff;text-shadow:0 2px 16px rgba(0,0,0,.25);margin-bottom:14px;text-align:center}
    .welcome .card h2{color:#523fd7;font-size:1.6rem;margin-bottom:8px}
    .welcome .card p{color:#4b5563;line-height:1.6;font-size:1.02rem;margin:10px auto;max-width:880px}
    .quote{font-style:italic;color:#6b7280}
    .actions{display:flex;gap:12px;justify-content:center;margin-top:18px;flex-wrap:wrap}
    .btn{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:0;border-radius:999px;padding:14px 22px;font-size:1rem;cursor:pointer;box-shadow:0 10px 24px rgba(102,126,234,.45);transition:transform .18s ease,box-shadow .18s ease}
    .btn:hover{transform:translateY(-2px);box-shadow:0 14px 34px rgba(102,126,234,.6)}
    .btn.secondary{background:#fff;color:#5b67e5;border:2px solid #5b67e5;box-shadow:none}
    .btn.secondary:hover{background:#f5f6ff}

    /* Game */
    .game{display:none;height:100%;grid-template-rows:auto 10px 1fr;gap:10px}
    .header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .title{color:#fff;text-shadow:0 2px 16px rgba(0,0,0,.3);font-weight:700;font-size:clamp(1.1rem,2.2vw,1.6rem)}
    .hud.card{display:flex;align-items:center;justify-content:space-between;gap:18px}
    .stat{display:flex;align-items:center;gap:8px;font-weight:700;color:#5b67e5}
    .stat small{color:#6b7280;font-weight:600}
    .progress{background:#ffffff55;border-radius:8px;overflow:hidden;height:10px}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#4caf50 0%,#8bc34a 100%);color:#fff;font-size:.7rem;line-height:10px;text-align:center;transition:width .45s ease}

    .main{display:grid;grid-template-columns:1.2fr 1fr;gap:10px;height:calc(100% - 0px)}

    /* Scenario draggable */
    .scenario.card{display:grid;grid-template-rows:auto auto 1fr auto;place-items:center;text-align:center}
    .scenario .label{color:#a855f7;font-size:.85rem;font-weight:800;letter-spacing:.08em;text-transform:uppercase;margin-bottom:6px}
    .emoji-scene{font-size:2.2rem;filter:drop-shadow(0 6px 10px rgba(0,0,0,.15));animation:float 3s ease-in-out infinite}
    .dragSrc{user-select:none;cursor:grab;background:linear-gradient(180deg,#f8faff,#eef2ff);border:2px dashed #667eea;padding:16px;border-radius:14px;max-width:92%}
    .dragSrc:active{cursor:grabbing}
    .scenario .text{font-size:clamp(1rem,1.6vw,1.18rem);line-height:1.55;color:#1f2937}
    .dragTip{font-size:.88rem;color:#6b7280;margin-top:10px}

    /* Drop targets */
    .choices.card{display:grid;grid-template-rows:auto 1fr;overflow:hidden}
    .choices h3{color:#5b67e5;margin-bottom:6px}
    .targets{display:grid;grid-template-columns:1fr;gap:8px;align-content:center}
    .tile{display:flex;align-items:flex-start;gap:12px;border-radius:12px;border:3px solid transparent;background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);padding:12px 14px;transition:transform .12s ease,box-shadow .12s ease,border-color .12s ease}
    .tile:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.2);border-color:#667eea;background:linear-gradient(135deg,#e3f2fd 0%,#bbdefb 100%)}
    .tile .letter{background:#667eea;color:#fff;width:34px;height:34px;display:grid;place-items:center;border-radius:999px;font-weight:800;flex-shrink:0}
    .tile.correct{background:linear-gradient(135deg,#84fab0 0%,#8fd3f4 100%);border-color:#2e7d32}
    .tile.incorrect{background:linear-gradient(135deg,#ff9a9e 0%,#fecfef 100%);border-color:#c62828}
    .tname{font-weight:800;color:#111827;font-size:1rem}
    .ttag{font-size:.85rem;color:#374151}
    .tcat{font-size:.78rem;color:#6b7280;font-style:italic}

    /* Overlay */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:999;animation:fadeIn .2s ease}
    .overlay.show{display:flex}
    .fbox{background:#fff;padding:36px 48px;border-radius:16px;text-align:center;box-shadow:0 16px 36px rgba(0,0,0,.35);animation:scaleIn .25s ease;max-width:820px;position:relative}
    .fbox h2{font-size:2.2rem;margin-bottom:6px}
    .fbox.correct h2{color:#2e7d32}
    .fbox.incorrect h2{color:#c62828}
    .fbox p{color:#374151;font-size:1.05rem}
    .explain{margin-top:10px;color:#1f2937;font-size:1rem}
    .reflect{margin-top:12px;color:#4b5563;font-size:.98rem}
    .closex{position:absolute;top:10px;right:10px;border:none;background:#eef;color:#4b57d6;width:34px;height:34px;border-radius:50%;font-weight:800;cursor:pointer}
    .closex:hover{filter:brightness(.95)}
    .stay{margin-top:10px;font-size:.85rem;color:#6b7280}

    /* Done */
    .done{display:none;height:100%;place-items:center;text-align:center}
    .done h1{color:#4caf50;font-size:clamp(1.6rem,3vw,2.6rem);margin-bottom:10px}
    .stats{display:flex;gap:20px;justify-content:center;margin:18px 0 10px;flex-wrap:wrap}
    .statbox{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:22px 28px;border-radius:14px;min-width:160px}
    .statbox .lab{opacity:.92;font-size:.95rem}
    .statbox .val{font-weight:800;font-size:2rem}

    /* Animations */
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes scaleIn{from{transform:scale(.88)}to{transform:scale(1)}}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}

    @media (max-width:900px){.main{grid-template-columns:1fr;grid-template-rows:1fr 1fr}.scenario .text{max-width:96%}.targets{grid-template-columns:1fr}}
    @media (min-width:901px){.targets{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <section class="welcome" id="welcome">
      <div class="welcome-inner">
        <h1>üß† AI & Cognitive Biases ‚Äî Counselor Edition</h1>
        <div class="card">
          <h2>Welcome, Counselors and Curious Minds üåø</h2>
          <p>We all carry subtle mental shortcuts that shape how we see clients, colleagues, and technology. This interactive reflection game presents <strong>37 human, real‚Äëworld counseling moments</strong> where a thinking trap sneaks in.</p>
          <p>Your task: <strong>drag the scenario card onto the thinking trap it reveals</strong>. There are no trick questions‚Äîjust awareness, humility, and a little humor.</p>
          <p class="quote">‚ÄúNotice the pattern. Name it with care. Choose your next best move.‚Äù</p>
          <div class="actions">
            <button class="btn" id="startQuick">üöÄ Quick Play (10)</button>
            <button class="btn secondary" id="startFull">üß© Full Deck (37)</button>
          </div>
        </div>
      </div>
    </section>

    <section class="game" id="game">
      <div class="header">
        <div class="title">üéØ Match the Thinking Trap (Drag the card onto a tile)</div>
        <div class="hud card">
          <div class="stat">Score: <span id="score">0</span><small>/</small><span id="total">0</span></div>
          <div class="stat">Accuracy: <span id="acc">0%</span></div>
        </div>
      </div>
      <div class="progress card"><div class="bar" id="bar">Question 0</div></div>
      <div class="main">
        <div class="scenario card">
          <div class="label">üé≠ Counseling Scenario</div>
          <div id="emoji" class="emoji-scene" aria-hidden="true">üßë‚Äç‚öïÔ∏èüí≠</div>
          <div id="dragSrc" class="dragSrc" draggable="true" aria-grabbed="false">
            <div class="text" id="scenario"></div>
          </div>
          <div class="dragTip">Drag this card onto a fallacy tile ‚Üí (or press 1‚Äì5)</div>
        </div>
        <div class="choices card">
          <h3>Drop onto the correct fallacy</h3>
          <div class="targets" id="targets"></div>
        </div>
      </div>
    </section>

    <section class="done" id="done">
      <div class="card" style="max-width:900px;">
        <h1>üéâ Game Complete!</h1>
        <p style="color:#555;font-size:1.05rem">Awareness is a practice. Thanks for playing with curiosity and care.</p>
        <div class="stats">
          <div class="statbox"><div class="lab">Final Score</div><div class="val" id="finalScore">0</div></div>
          <div class="statbox"><div class="lab">Accuracy</div><div class="val" id="finalAcc">0%</div></div>
        </div>
        <div class="actions" style="margin-top:10px">
          <button class="btn" id="playAgain">üîÑ Play Again</button>
        </div>
      </div>
    </section>
  </div>

  <!-- Feedback overlay with manual close (X) and ESC support + countdown + reflection prompt -->
  <div class="overlay" id="overlay" aria-modal="true" role="dialog">
    <div class="fbox" id="fbox">
      <button class="closex" id="closex" aria-label="Close feedback">√ó</button>
      <h2 id="ficon">‚úì</h2>
      <p id="fmsg"></p>
      <div class="explain" id="explain"></div>
      <div class="reflect" id="reflect"></div>
      <div class="stay">(Closes in <span id="count">8</span>s ‚Äî or press <strong>Esc</strong>, click outside, or √ó)</div>
    </div>
  </div>

<script>
  // === 37 SINGLE-BIAS ITEMS ===
  // Each has: name, tag (tile tagline), emoji (mini-cartoon), scenario (human vignette), explain (definition), reflect (prompt)
  const DATA=[
    {name:"Status Quo Bias",tag:"Resisting change even when better options exist",emoji:"üßë‚Äç‚öïÔ∏èüìÑüóÇÔ∏è",scenario:"‚ÄúPaper works fine,‚Äù says a therapist, waving off patient portal requests‚Äîthough missed intakes keep piling up.",explain:"Preference for the current state; changes feel risky or costly.",reflect:"Where does familiarity feel safer than effectiveness?"},
    {name:"Minimization",tag:"Downplaying disconfirming evidence",emoji:"üßë‚Äçüè´ü§∑‚Äç‚ôÇÔ∏èüìù",scenario:"A supervisor calls AI note‚Äëtaking a fad‚Äîeven after three colleagues say it saved hours and reduced burnout.",explain:"Reducing the significance of evidence that challenges one‚Äôs stance.",reflect:"What would it cost you to admit this might help?"},
    {name:"Normalcy Bias",tag:"Assuming the future mirrors the past",emoji:"üóìÔ∏èüòå",scenario:"A practice owner maps a 5‚Äëyear plan as if tech will stay put‚Äîdespite monthly clinical AI breakthroughs.",explain:"Underestimating the speed/impact of change; expecting continuity.",reflect:"What would you change if change were certain?"},
    {name:"Confirmation Bias",tag:"Seeking only supporting evidence",emoji:"üîçüìö",scenario:"Before an AI training, a counselor googles only ‚ÄòAI harms therapy‚Äô and stops there.",explain:"Tendency to favor information that confirms pre‚Äëexisting beliefs.",reflect:"What would count as good evidence against your view?"},
    {name:"Rationalization",tag:"Nice‚Äësounding reasons to avoid discomfort",emoji:"üé≠üó£Ô∏è",scenario:"‚ÄúIt threatens the sacred alliance,‚Äù a clinician says‚Äîwhile spending two hours nightly on paperwork she could automate.",explain:"Constructing plausible justifications for a choice driven by avoidance.",reflect:"What fear might this explanation be protecting?"},
    {name:"Appeal to Tradition",tag:"‚ÄòWe‚Äôve always done it this way‚Äô",emoji:"üìúüèõÔ∏è",scenario:"‚ÄúTherapists meet in person‚Äîperiod,‚Äù says a counselor, dismissing AI‚Äëassisted telehealth scheduling out of hand.",explain:"Arguing something is right because it‚Äôs traditional.",reflect:"When did tradition once begin as innovation?"},
    {name:"In‚Äëgroup Bias",tag:"Favoring one‚Äôs own circle",emoji:"üë•üèôÔ∏è",scenario:"A clinic keeps only urban, well‚Äëinsured clients‚Äîignoring AI‚Äëenabled rural access.",explain:"Prioritizing benefits for one‚Äôs own group over others.",reflect:"Who is missing from your waiting room‚Äîand why?"},
    $1Late at night, scrolling headlines about chatbots, a counselor whispers, ‚ÄúSo this is how it ends.‚Äù$3"Exaggerating the likelihood or severity of disaster.",reflect:"What‚Äôs a reasonable best‚Äëcase to hold alongside the fear?"},
    {name:"Ambiguity Aversion",tag:"Avoiding the unfamiliar",emoji:"‚ùìüò¨",scenario:"Never trying AI tools, a therapist imagines only ‚Äòrobot takeover‚Äô‚Äîuntil a 20‚Äëminute demo calms them down.",explain:"Preference for known risks over unknowns.",reflect:"Where can you try a low‚Äëstakes experiment?"},
    {name:"Identity‚ÄëProtective Cognition",tag:"Defending status/identity",emoji:"üõ°Ô∏èüßë‚Äç‚öïÔ∏è",scenario:"‚ÄúReal clinicians don‚Äôt need tech,‚Äù says a senior therapist when diagnostic support tools arrive.",explain:"Rejecting information that threatens one‚Äôs group identity or status.",reflect:"What part of your identity feels at stake here?"},
    {name:"Negativity Bias",tag:"Heavier weight on bad news",emoji:"üìâüß†",scenario:"Daily doom‚Äëchecking ‚ÄòAI will end therapy‚Äô leaves a counselor too anxious to learn anything new.",explain:"Attending to and remembering negatives more than positives.",reflect:"What balanced source could widen your view today?"},
    {name:"Availability Heuristic",tag:"Judging by vivid examples",emoji:"üóûÔ∏èüò®",scenario:"After one viral story of a harmful bot, a clinician assumes all AI tools are dangerous.",explain:"Estimating frequency/risk by ease of recall.",reflect:"How representative is that dramatic example?"},
    {name:"Cognitive Dissonance",tag:"Tension between beliefs and facts",emoji:"üòµ‚öñÔ∏è",scenario:"‚ÄúAI has no place here,‚Äù says a counselor‚Äîthen quietly loves how their CE site personalizes lessons.",explain:"Discomfort from holding conflicting beliefs/behaviors.",reflect:"What small step could integrate the two truths?"},
    {name:"Need for Closure",tag:"Craving quick certainty",emoji:"üö™‚è±Ô∏è",scenario:"‚ÄúIt‚Äôs good or bad‚Äîdecide,‚Äù a therapist says, refusing a pilot to learn more.",explain:"Preference for definite answers; discomfort with ambiguity.",reflect:"What would a time‚Äëboxed trial teach you?"},
    {name:"Intolerance of Uncertainty",tag:"Difficulty acting with unknowns",emoji:"‚öñÔ∏èü§î",scenario:"A supervisor wants guarantees about AI outcomes before allowing any trial.",explain:"Struggle to proceed under reasonable uncertainty.",reflect:"How can you set safe bounds for learning?"},
    {name:"Red Herring",tag:"Changing the subject to avoid the point",emoji:"üêü‚Ü™Ô∏è",scenario:"During scheduling planning, a clinician pivots to debating ‚Äòtrue consciousness.‚Äô",explain:"Introducing an irrelevant issue to distract from the core question.",reflect:"What decision are we avoiding right now?"},
    {name:"Focusing Illusion",tag:"Overweighting one salient feature",emoji:"üî¨üéØ",scenario:"Fixating on ‚ÄòAI lacks empathy,‚Äô a counselor ignores how admin tools could free 10 hours for empathy.",explain:"Placing too much emphasis on one aspect; neglecting the rest.",reflect:"What benefits are outside your spotlight?"},
    {name:"Sunk Cost Fallacy",tag:"Past investment traps present choices",emoji:"üí∏üï∞Ô∏è",scenario:"‚ÄúI learned this old system,‚Äù says a clinician, refusing a time‚Äësaving alternative.",explain:"Continuing a bad option because of prior investment.",reflect:"If you started today, what would you pick?"},
    {name:"False Dichotomy",tag:"Forcing either/or",emoji:"‚ö°‚ÜîÔ∏è",scenario:"‚ÄúEither go all‚Äëin on AI and lose our soul, or reject it to stay human.‚Äù",explain:"Framing a binary while ignoring middle paths.",reflect:"What hybrid would respect values and improve care?"},
    {name:"Loss Aversion",tag:"Losses loom larger than gains",emoji:"üìâüòü",scenario:"A new therapist fears ‚Äòmy degree will be worthless‚Äô instead of exploring AI‚Äëcomplementary skills.",explain:"Weighing potential losses more than equivalent gains.",reflect:"What could you gain by adapting 5%?"},
    {name:"Anthropomorphism",tag:"Giving tools human motives",emoji:"ü§ñ‚ù§Ô∏è",scenario:"‚ÄúThe AI is trying to replace us,‚Äù says a counselor, as if the tool intends anything.",explain:"Attributing human traits or intentions to nonhumans.",reflect:"What‚Äôs the actual function‚Äînot the fantasy?"},
    {name:"Automation Bias",tag:"Over‚Äëtrusting tech",emoji:"‚ú®üß∞",scenario:"Choosing AI advice over peer consultation because ‚Äòit never judges me.‚Äô",explain:"Excessive reliance on automated output over judgment.",reflect:"Who‚Äôs your human double‚Äëcheck?"},
    {name:"Projection",tag:"Attributing my fear to you",emoji:"ü™û‚û°Ô∏è",scenario:"Feeling inadequate, a counselor accuses colleagues who use AI of ‚Äòcheating.‚Äô",explain:"Attributing one‚Äôs unacceptable feelings to others.",reflect:"What part of this is about me?"},
    {name:"Magical Thinking",tag:"Imagining mystical causal power",emoji:"‚ú®üîÆ",scenario:"A clinician says AI can read minds and predict the future.",explain:"Believing thoughts/objects have supernatural effects.",reflect:"What evidence would bring this back to earth?"},
    {name:"Illusory Pattern Perception",tag:"Seeing plots where none exist",emoji:"üïµÔ∏è‚Äç‚ôÇÔ∏èüï∏Ô∏è",scenario:"A therapist reads each press release as proof of a secret plan to destroy counseling.",explain:"Detecting patterns/intent in random or unrelated events.",reflect:"What benign explanations fit the facts?"},
    {name:"Echo Chamber Effect",tag:"Only hearing people like me",emoji:"üîÅüì¢",scenario:"Leaving supervision, a counselor talks only to folks who already agree about AI.",explain:"Information ecosystems that reinforce existing beliefs.",reflect:"Whose thoughtful critique could you invite?"},
    {name:"Illusory Superiority",tag:"I‚Äôm uniquely right/special",emoji:"üëë‚ú®",scenario:"A counselor claims AI has ‚Äòchosen‚Äô them for special insight above ‚Äòordinary‚Äô peers.",explain:"Overestimating one‚Äôs abilities or status.",reflect:"Where do peers help you reality‚Äëcheck?"},
    {name:"System Justification",tag:"Defending the status quo order",emoji:"üèõÔ∏èüîí",scenario:"‚ÄúThe system is fine,‚Äù a clinician says, minimizing how access rules distort care.",explain:"Motivation to see existing arrangements as fair/legitimate.",reflect:"Who benefits‚Äîand who pays‚Äîin our current setup?"},
    {name:"Human Exceptionalism Bias",tag:"Humans are always superior",emoji:"üßë‚Äç‚öïÔ∏è‚ú®",scenario:"‚ÄúHumans are inherently better at therapy,‚Äù a counselor asserts, despite data showing mixed results.",explain:"Assuming human superiority by default across all tasks.",reflect:"Where might partnership beat purity?"},
    {name:"Belief Perseverance",tag:"Sticking with a belief after it‚Äôs refuted",emoji:"üìåüß†",scenario:"Even after trials show benefits, a counselor insists ‚ÄòAI can‚Äôt possibly help.‚Äô",explain:"Maintaining prior beliefs despite contrary evidence.",reflect:"What new data would you allow to change your mind?"},
    {name:"Availability Cascade",tag:"Repetition feels like truth",emoji:"üîÅüóûÔ∏è",scenario:"After hearing the same rumor repeatedly, a clinician starts to ‚Äòjust know‚Äô it‚Äôs true.",explain:"A belief gains plausibility through social repetition.",reflect:"Are many sources actually one echo?"},
    {name:"Zero‚ÄëSum Bias",tag:"If others gain, I must lose",emoji:"‚ûñ‚ûï",scenario:"A therapist assumes AI‚Äôs value means less value for counselors‚Äîfull stop.",explain:"Perceiving benefits as inherently competitive rather than expandable.",reflect:"Where could value grow for all parties?"},
    {name:"Omission Bias",tag:"Harm by inaction feels safer",emoji:"‚è∏Ô∏èüßØ",scenario:"A team debates AI transcription for months instead of a two‚Äëweek pilot that would give data.",explain:"Judging harmful inaction as less bad than harmful action.",reflect:"What tiny action would create real learning?"},
    {name:"Affect Heuristic",tag:"Feelings drive risk judgments",emoji:"üíì‚öñÔ∏è",scenario:"Because AI ‚Äòfeels cold,‚Äô a therapist rates it riskier than evidence suggests.",explain:"Using current emotion as a shortcut for evaluating risk/benefit.",reflect:"What does the evidence say when feelings are acknowledged?"},
    {name:"Anchoring",tag:"Stuck to the first idea",emoji:"‚öìüß†",scenario:"After an early bad demo, a clinician anchors on ‚ÄòAI is useless‚Äô despite later improvements.",explain:"Relying too heavily on an initial piece of information.",reflect:"What fresh baseline could you anchor to now?"},
    {name:"Group Polarization",tag:"Like‚Äëminded groups grow extreme",emoji:"üë•üî•",scenario:"In a closed online forum, opinions about AI drift toward ‚Äòall or nothing.‚Äô",explain:"Deliberation within similar groups pushes views to extremes.",reflect:"Who could productively disagree with you?"}
  ];

  // State & helpers
  const $=s=>document.querySelector(s);
  const shuffle=a=>a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(x=>x[1]);
  const state={deck:[],qIndex:0,score:0,attempts:0,total:0,current:null};

  function startGame(n){
    $('#welcome').style.display='none';
    $('#done').style.display='none';
    $('#game').style.display='grid';
    state.deck=shuffle([...DATA]).slice(0,Math.min(n,DATA.length));
    state.qIndex=0;state.score=0;state.attempts=0;state.total=state.deck.length;
    $('#total').textContent=state.total;$('#score').textContent=0;$('#acc').textContent='0%';
    renderQuestion();
  }

  function renderQuestion(){
    const item=state.deck[state.qIndex];
    state.current=item;
    // Emoji mini-cartoon
    $('#emoji').textContent=item.emoji||'üßë‚Äç‚öïÔ∏èüí≠';
    $('#scenario').textContent=item.scenario;
    updateProgress();

    // Build 5 tiles: 1 correct + 4 distractors
    const pool=DATA.filter(x=>x.name!==item.name);
    const distractors=shuffle(pool).slice(0,4);
    const opts=shuffle([item,...distractors]);
    const letters=['1','2','3','4','5'];
    $('#targets').innerHTML=opts.map((o,i)=>`
      <div class="tile" tabindex="0" role="button" aria-label="${o.name}" data-name="${o.name.replace(/"/g,'&quot;')}">
        <div class="letter">${letters[i]}</div>
        <div>
          <div class="tname">${o.name}</div>
          <div class="ttag">${o.tag||''}</div>
          <div class="tcat">${o.emoji||''} ${o.cat||''}</div>
        </div>
      </div>`).join('');

    // Drag & drop wiring
    const src=$('#dragSrc');
    src.setAttribute('draggable','true');
    src.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain','scenario'); src.setAttribute('aria-grabbed','true'); });
    src.addEventListener('dragend',()=> src.setAttribute('aria-grabbed','false'));

    document.querySelectorAll('.tile').forEach(tile=>{
      tile.addEventListener('dragover',e=>{ e.preventDefault(); tile.style.borderColor='#667eea'; });
      tile.addEventListener('dragleave',()=>{ tile.style.borderColor='transparent'; });
      tile.addEventListener('drop',e=>{ e.preventDefault(); tile.style.borderColor='transparent'; handleChoice(tile.getAttribute('data-name')); });
      tile.addEventListener('click',()=> handleChoice(tile.getAttribute('data-name')));
      tile.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); handleChoice(tile.getAttribute('data-name')); }});
    });

    // Keyboard shortcuts 1‚Äì5
    window.onkeydown=e=>{
      if(['1','2','3','4','5'].includes(e.key)){
        const idx=parseInt(e.key,10)-1; const t=document.querySelectorAll('.tile')[idx]; if(t) handleChoice(t.getAttribute('data-name'));
      }
    };
  }

  async function handleChoice(name){
    const correct=state.current;
    const ok = name===correct.name;
    state.attempts++;

    document.querySelectorAll('.tile').forEach(t=>{
      const isSel = t.getAttribute('data-name')===name;
      if(isSel) t.classList.add(ok? 'correct':'incorrect');
      t.style.pointerEvents='none';
    });

    if(ok){ state.score++; await showFeedback(true,`Correct ‚Äî ${correct.name}`,correct.explain,correct.reflect); }
    else { await showFeedback(false,`Not quite. Answer: ${correct.name}`,correct.explain,correct.reflect); }

    updateHUD();
    next();
  }

  function updateHUD(){
    $('#score').textContent=state.score;
    const acc=state.attempts?Math.round((state.score/state.attempts)*100):0;
    $('#acc').textContent=acc+'%';
  }

  function updateProgress(){
    const pct=Math.round(((state.qIndex+1)/state.total)*100);
    const bar=$('#bar');bar.style.width=pct+'%';bar.textContent=`Question ${state.qIndex+1} of ${state.total}`;
  }

  function next(){
    state.qIndex++;
    if(state.qIndex<state.total){renderQuestion();} else {finish();}
  }

  function finish(){
    $('#game').style.display='none';
    $('#done').style.display='grid';
    $('#finalScore').textContent=`${state.score}/${state.total}`;
    const acc=state.attempts?Math.round((state.score/state.attempts)*100):0;
    $('#finalAcc').textContent=acc+'%';
  }

  // Feedback overlay with manual close and 8s countdown + reflection
  const AUTO_CLOSE_MS=8000; // 8 seconds
  function showFeedback(ok,msg,explain,reflect){
    return new Promise(resolve=>{
      const o=$('#overlay'), box=$('#fbox'), close=$('#closex'), count=$('#count');
      box.className='fbox '+(ok?'correct':'incorrect');
      $('#ficon').textContent=ok?'‚úì':'‚úó';
      $('#fmsg').textContent=msg; $('#explain').textContent=explain||''; $('#reflect').textContent=reflect||'';
      let remaining = Math.floor(AUTO_CLOSE_MS/1000); count.textContent=remaining;
      o.classList.add('show');
      const tick=setInterval(()=>{ remaining--; if(remaining>=0) count.textContent=remaining; },1000);
      const cleanup=()=>{ clearInterval(tick); o.classList.remove('show'); o.removeEventListener('click',outside); close.removeEventListener('click',onClose); document.removeEventListener('keydown',onEsc); clearTimeout(timer); resolve(); };
      const outside=e=>{ if(e.target===o) cleanup(); };
      const onClose=()=>cleanup();
      const onEsc=e=>{ if(e.key==='Escape') cleanup(); };
      o.addEventListener('click',outside); close.addEventListener('click',onClose); document.addEventListener('keydown',onEsc);
      const timer=setTimeout(()=>cleanup(),AUTO_CLOSE_MS);
    });
  }

  // wire buttons
  $('#startQuick').addEventListener('click',()=>startGame(10));
  $('#startFull').addEventListener('click',()=>startGame(DATA.length));
  $('#playAgain').addEventListener('click',()=>document.location.reload());
</script>
</body>
</html>
