<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>AI Cognitive Bias Matcher</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;touch-action:manipulation}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:radial-gradient(1200px 800px at 10% 10%,#7aa2ff33,transparent 60%),
                 radial-gradient(1000px 700px at 90% 20%,#e7b6ff33,transparent 60%),
                 linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      color:#222;height:100vh;overflow:hidden;display:flex;align-items:center;justify-content:center;padding:10px
    }
    .container{width:98vw;height:98vh;display:flex;flex-direction:column}
    .card{background:#fff;border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.18);padding:24px;animation:fadeIn .4s ease}
    .welcome{height:100%;display:grid;place-items:center;overflow-y:auto}
    .welcome-inner{max-width:980px;padding:10px}
    .welcome h1{font-size:clamp(1.4rem,5vw,2.6rem);color:#fff;text-shadow:0 2px 16px rgba(0,0,0,.25);margin-bottom:14px;text-align:center}
    .welcome .card h2{color:#667eea;font-size:clamp(1.2rem,4vw,1.4rem);margin-bottom:6px}
    .welcome .card p{color:#555;line-height:1.55;font-size:clamp(0.9rem,3vw,1rem);margin:10px auto;max-width:860px}
    .actions{display:flex;gap:12px;justify-content:center;margin-top:18px;flex-wrap:wrap}
    .btn{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:0;border-radius:999px;padding:14px 22px;font-size:1rem;cursor:pointer;box-shadow:0 10px 24px rgba(102,126,234,.45);transition:transform .18s ease,box-shadow .18s ease;min-height:48px;min-width:140px}
    .btn:hover{transform:translateY(-2px);box-shadow:0 14px 34px rgba(102,126,234,.6)}
    .btn:active{transform:translateY(0)}
    .btn.secondary{background:#fff;color:#5b67e5;border:2px solid #5b67e5;box-shadow:none}
    .btn.secondary:hover{background:#f5f6ff}
    .game{display:none;height:100%;grid-template-rows:auto 10px 1fr;gap:10px}
    .header{display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap}
    .title{color:#fff;text-shadow:0 2px 16px rgba(0,0,0,.3);font-weight:700;font-size:clamp(1rem,3.5vw,1.6rem)}
    .hud.card{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 16px}
    .stat{display:flex;align-items:center;gap:6px;font-weight:600;color:#667eea;font-size:clamp(0.85rem,2.5vw,1rem)}
    .stat small{color:#555;font-weight:500}
    .progress{background:#ffffff55;border-radius:8px;overflow:hidden;height:10px}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#4caf50 0%,#8bc34a 100%);color:#fff;font-size:.7rem;line-height:10px;text-align:center;transition:width .45s ease}
    .main{display:grid;grid-template-columns:1fr;gap:10px;height:100%;overflow-y:auto}
    .scenario.card{display:grid;grid-template-rows:auto auto 1fr auto;place-items:center;text-align:center;padding:16px;min-height:0}
    .scenario .label{color:#764ba2;font-size:.75rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:6px}
    .scenario-img{max-width:180px;border-radius:10px;margin-bottom:12px;box-shadow:0 4px 10px rgba(0,0,0,.2)}
    .dragSrc{user-select:none;cursor:pointer;background:#f8f9ff;border:2px dashed #667eea;padding:14px;border-radius:12px;max-width:100%;touch-action:none}
    .dragSrc.dragging{opacity:0.5;border-color:#764ba2}
    .scenario .text{font-size:clamp(0.9rem,3vw,1.2rem);line-height:1.45;color:#222}
    .dragTip{font-size:.8rem;color:#666;margin-top:8px}
    .choices.card{display:grid;grid-template-rows:auto 1fr;overflow:hidden;padding:16px;min-height:0}
    .choices h3{color:#667eea;margin-bottom:8px;font-size:clamp(1rem,3.5vw,1.2rem)}
    .targets{display:grid;grid-template-columns:1fr;gap:8px;align-content:start;overflow-y:auto;padding-right:4px}
    .tile{display:flex;align-items:center;gap:10px;border-radius:12px;border:3px solid transparent;background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);padding:12px;transition:transform .12s ease,box-shadow .12s ease,border-color .12s ease;cursor:pointer;min-height:48px;touch-action:manipulation}
    .tile:hover,.tile:active{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.2);border-color:#667eea;background:linear-gradient(135deg,#e3f2fd 0%,#bbdefb 100%)}
    .tile.over{border-color:#667eea;background:linear-gradient(135deg,#e3f2fd 0%,#bbdefb 100%)}
    .tile .letter{background:#667eea;color:#fff;width:32px;height:32px;display:grid;place-items:center;border-radius:999px;font-weight:800;flex-shrink:0;font-size:0.9rem}
    .tile.correct{background:linear-gradient(135deg,#84fab0 0%,#8fd3f4 100%);border-color:#2e7d32}
    .tile.incorrect{background:linear-gradient(135deg,#ff9a9e 0%,#fecfef 100%);border-color:#c62828}
    .tname{font-weight:700;color:#222;font-size:clamp(0.85rem,2.8vw,0.98rem)}
    .tcat{font-size:clamp(0.7rem,2.3vw,0.8rem);color:#555;font-style:italic}
    .tdesc{font-size:clamp(0.75rem,2.5vw,0.82rem);color:#444;margin-top:2px}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:999;animation:fadeIn .2s ease;padding:16px}
    .overlay.show{display:flex}
    .fbox{background:#fff;padding:24px;border-radius:14px;text-align:center;box-shadow:0 16px 36px rgba(0,0,0,.35);animation:scaleIn .25s ease;max-width:90vw;max-height:90vh;overflow-y:auto;position:relative}
    .fbox h2{font-size:clamp(1.6rem,6vw,2.2rem);margin-bottom:10px}
    .fbox.correct h2{color:#2e7d32}
    .fbox.incorrect h2{color:#c62828}
    .fbox p{color:#444;font-size:clamp(0.9rem,3vw,1.05rem);line-height:1.5}
    .explain{margin-top:10px;color:#333;font-size:clamp(0.85rem,2.8vw,0.98rem);line-height:1.5}
    .closex{position:absolute;top:8px;right:8px;border:none;background:#eef;color:#4b57d6;width:36px;height:36px;border-radius:50%;font-weight:800;cursor:pointer;font-size:1.2rem}
    .closex:hover{filter:brightness(.95)}
    .stay{margin-top:12px;font-size:clamp(0.75rem,2.5vw,0.85rem);color:#666}
    .done{display:none;height:100%;place-items:center;text-align:center;overflow-y:auto;padding:16px}
    .done h1{color:#4caf50;font-size:clamp(1.6rem,6vw,2.6rem);margin-bottom:10px}
    .stats{display:flex;gap:16px;justify-content:center;margin:18px 0 10px;flex-wrap:wrap}
    .statbox{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:18px 24px;border-radius:14px;min-width:140px}
    .statbox .lab{opacity:.92;font-size:clamp(0.85rem,2.8vw,0.95rem)}
    .statbox .val{font-weight:800;font-size:clamp(1.6rem,6vw,2rem)}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes scaleIn{from{transform:scale(.88)}to{transform:scale(1)}}
    @media (max-width:768px){
      body{padding:5px}
      .container{width:100vw;height:100vh}
      .card{padding:16px;border-radius:12px}
      .welcome .card{padding:20px}
      .game{gap:8px}
      .header{gap:6px}
      .hud.card{padding:10px 12px;gap:8px}
      .stat{gap:4px;font-size:0.85rem}
      .main{gap:8px}
      .scenario.card{padding:12px}
      .scenario-img{max-width:140px;margin-bottom:8px}
      .dragSrc{padding:12px}
      .dragTip{font-size:0.75rem;margin-top:6px}
      .choices.card{padding:12px}
      .targets{gap:6px}
      .tile{padding:10px;gap:8px}
      .tile .letter{width:28px;height:28px;font-size:0.85rem}
      .fbox{padding:20px}
      .actions{gap:10px}
      .btn{padding:12px 18px;font-size:0.95rem;min-width:120px}
      .statbox{padding:16px 20px;min-width:120px}
    }
    @media (max-width:480px){
      .scenario-img{max-width:120px}
      .tile{padding:8px;gap:6px}
      .tile .letter{width:26px;height:26px;font-size:0.8rem}
      .fbox{padding:16px}
      .btn{padding:10px 16px;font-size:0.9rem;min-width:100px}
    }
    @media (max-width:900px) and (orientation:landscape){
      .main{grid-template-columns:1fr 1fr;grid-template-rows:1fr}
      .scenario .text{max-width:96%}
    }
  </style>
</head>
<body>
  <div class="container">
    <section class="welcome" id="welcome">
      <div class="welcome-inner">
        <h1>üß† AI & Cognitive Biases</h1>
        <div class="card">
          <h2>Welcome, Counselors!</h2>
          <p>Understanding our cognitive biases about AI helps us serve clients more effectively.</p>
          <p>Match scenarios with the cognitive biases at play. <strong>Tap/drag the scenario onto the correct fallacy</strong>.</p>
          <div class="actions">
            <button class="btn" id="startQuick">üöÄ Quick Play (10)</button>
            <button class="btn secondary" id="startFull">üß© Full Deck (36)</button>
          </div>
        </div>
      </div>
    </section>

    <section class="game" id="game">
      <div class="header">
        <div class="title">üéØ Match the Bias</div>
        <div class="hud card">
          <div class="stat">Score: <span id="score">0</span><small>/</small><span id="total">0</span></div>
          <div class="stat">Accuracy: <span id="acc">0%</span></div>
        </div>
      </div>
      <div class="progress card"><div class="bar" id="bar">Question 0</div></div>
      <div class="main">
        <div class="scenario card">
          <div class="label">üé≠ Scenario</div>
          <img id="sImg" class="scenario-img" alt="" />
          <div id="dragSrc" class="dragSrc" draggable="true">
            <div class="text" id="scenario"></div>
          </div>
          <div class="dragTip">Tap/drag onto a tile ‚Üì</div>
        </div>
        <div class="choices card">
          <h3>Select the correct fallacy</h3>
          <div class="targets" id="targets"></div>
        </div>
      </div>
    </section>

    <section class="done" id="done">
      <div class="card" style="max-width:900px;">
        <h1>üéâ Complete!</h1>
        <p style="color:#555">Thoughtful integration beats fear.</p>
        <div class="stats">
          <div class="statbox"><div class="lab">Final Score</div><div class="val" id="finalScore">0</div></div>
          <div class="statbox"><div class="lab">Accuracy</div><div class="val" id="finalAcc">0%</div></div>
        </div>
        <div class="actions" style="margin-top:10px">
          <button class="btn" id="playAgain">üîÑ Play Again</button>
        </div>
      </div>
    </section>
  </div>

  <div class="overlay" id="overlay">
    <div class="fbox" id="fbox">
      <button class="closex" id="closex">√ó</button>
      <h2 id="ficon">‚úì</h2>
      <p id="fmsg"></p>
      <div class="explain" id="explain"></div>
      <div class="stay">(Closes in <span id="count">8</span>s)</div>
    </div>
  </div>

<script>
(function(){
  var DATA = [
    {name:'Status Quo Bias',cat:'Resistance',icon:'üîí',tag:'Preferring the familiar',explain:'Keeping current routines because change feels costly.',scenario:'A therapist insists on paper intake forms because "my system works fine," despite clients requesting digital options.'},
    {name:'Belief Perseverance',cat:'Reasoning',icon:'üß±',tag:'Clinging to beliefs despite evidence',explain:'Beliefs maintained after disconfirming evidence.',scenario:'A supervisor dismisses AI note-taking as "just a fad," despite colleagues saving 5+ hours weekly.'},
    {name:'Normalcy Bias',cat:'Resistance',icon:'üìÖ',tag:'Assuming tomorrow looks like yesterday',explain:'Underestimating speed of change.',scenario:'A practice owner plans 5-year expansion assuming AI stays the same, ignoring monthly breakthroughs.'},
    {name:'Attitude Polarization',cat:'Reasoning',icon:'üåì',tag:'Pre-judging hardens stance',explain:'New info strengthens preexisting views.',scenario:'Before an AI workshop, a counselor declares "machines can never understand emotions."'},
    {name:'Rationalization',cat:'Defense',icon:'üé≠',tag:'Excuses that mask avoidance',explain:'Reasons that soothe rather than reflect reality.',scenario:'A psychologist argues about "sacred relationships" to avoid learning AI tools despite 2-hour nightly paperwork.'},
    {name:'Appeal to Tradition',cat:'Fallacy',icon:'üìú',tag:'Always done this way',explain:'Arguing from custom not evidence.',scenario:'A counselor argues against telehealth because "therapists have always met face-to-face for 100 years."'},
    {name:'In-group Bias',cat:'Fairness',icon:'üë•',tag:'Serving those like us',explain:'Favoring own group.',scenario:'A clinic serves only affluent in-person clients, refusing AI teletherapy for underserved communities.'},
    {name:'Catastrophizing',cat:'Distortion',icon:'üí•',tag:'Change equals doom',explain:'Overestimating worst-case outcomes.',scenario:'A counselor concludes "this is the end of our profession" after hearing about AI chatbots.'},
    {name:'Ambiguity Aversion',cat:'Risk',icon:'üò∞',tag:'Unknowns feel riskier',explain:'Preference for familiar risks.',scenario:'A therapist anxious about "robots taking over" becomes calm after a 20-minute AI demo.'},
    {name:'Identity-Protective Cognition',cat:'Social',icon:'üõ°Ô∏è',tag:'Protecting role',explain:'Discarding threatening evidence.',scenario:'A senior therapist argues "using technology shows we\'re not real clinicians."'},
    {name:'Negativity Bias',cat:'Attention',icon:'üìâ',tag:'Bad news sticks',explain:'Attending to negative information strongly.',scenario:'A counselor obsessed with "AI will eliminate jobs by 2030" checks apocalyptic news daily.'},
    {name:'Ostrich Effect',cat:'Attention',icon:'ü™∂',tag:'Avoiding discomfort',explain:'Avoiding knowledge requiring change.',scenario:'A therapist avoids reading about AI tools because unfamiliarity makes them anxious.'},
    {name:'Availability Heuristic',cat:'Judgment',icon:'üì∞',tag:'Vivid feels frequent',explain:'Estimating risk by ease of recall.',scenario:'After one viral article, a counselor assumes all AI mental health tools are dangerous.'},
    {name:'Confirmation Bias',cat:'Reasoning',icon:'üîç',tag:'Seeking affirmation',explain:'Filtering for confirmatory evidence.',scenario:'A skeptical therapist only reads articles criticizing AI, ignoring positive studies.'},
    {name:'Cognitive Dissonance',cat:'Conflict',icon:'üòµ',tag:'Tension between beliefs and facts',explain:'Discomfort from conflicting ideas.',scenario:'A counselor claiming "AI has no place" feels uncomfortable when their platform uses AI.'},
    {name:'Need for Closure',cat:'Motivation',icon:'üö™',tag:'Craving definitive answer',explain:'Low tolerance for uncertainty.',scenario:'A therapist declares "it\'s either good or bad" instead of exploring nuanced implications.'},
    {name:'Intolerance of Uncertainty',cat:'Risk',icon:'‚öñÔ∏è',tag:'Must be guaranteed',explain:'Difficulty with reasonable unknowns.',scenario:'A supervisor demands absolute certainty about AI impact before any pilot program.'},
    {name:'Red Herring',cat:'Fallacy',icon:'üêü',tag:'Changing topic',explain:'Introducing irrelevant issues.',scenario:'During AI scheduling discussion, a therapist debates whether AI has "true consciousness."'},
    {name:'Attentional Bias',cat:'Attention',icon:'üéØ',tag:'Fixating on one feature',explain:'Over-weighting salient attribute.',scenario:'A counselor fixates on AI lacking empathy, ignoring 10 more hours weekly for client contact.'},
    {name:'Information Bias',cat:'Decision',icon:'üßÆ',tag:'Analysis paralysis',explain:'Overvaluing discussion vs testing.',scenario:'A therapy group debates AI transcription for 6 months without running a 2-week pilot.'},
    {name:'Sunk Cost Fallacy',cat:'Decision',icon:'üí∏',tag:'Past effort traps choices',explain:'Continuing due to prior investment.',scenario:'A counselor continues outdated system because "I invested so much time learning it."'},
    {name:'False Dichotomy',cat:'Fallacy',icon:'‚ö°',tag:'Only two extreme choices',explain:'Forcing either/or frame.',scenario:'A therapist insists "embrace AI completely or reject it entirely," ignoring middle ground.'},
    {name:'Anchoring',cat:'Judgment',icon:'‚öì',tag:'First beliefs set reference',explain:'Initial assumptions shape judgments.',scenario:'A therapist struggles realizing AI can draft summaries as well as they can.'},
    {name:'Motivated Reasoning',cat:'Reasoning',icon:'üß†',tag:'Reasoning toward preference',explain:'Evaluating by desired conclusions.',scenario:'A therapist insists "humans are better" as comfort, despite equal AI outcomes.'},
    {name:'Argument from Incredulity',cat:'Fallacy',icon:'‚ùì',tag:'Can\'t imagine it',explain:'Concluding false because hard to believe.',scenario:'A counselor dismisses AI mood-tracking because "only humans understand emotions."'},
    {name:'Loss Aversion',cat:'Decision',icon:'üìâ',tag:'Losses loom larger',explain:'Overweighting potential losses.',scenario:'A therapist worries "AI will make my degree worthless" instead of developing complementary skills.'},
    {name:'Availability Cascade',cat:'Social',icon:'üì¢',tag:'Repetition feels like facts',explain:'Perceived truth through repetition.',scenario:'A therapist watches "AI will destroy care" videos repeatedly, fueling anxiety.'},
    {name:'Anthropomorphism',cat:'Attribution',icon:'ü§ñ',tag:'Giving tools human motives',explain:'Ascribing intention to systems.',scenario:'A counselor says "the AI is trying to replace us" as if it has motivations.'},
    {name:'Automation Bias',cat:'Trust',icon:'‚ú®',tag:'Over-trusting systems',explain:'Excessive reliance on automation.',scenario:'A therapist prefers AI advice because "AI never judges" avoiding peer feedback.'},
    {name:'Projection',cat:'Defense',icon:'ü™û',tag:'My fear, your problem',explain:'Attributing own feelings to others.',scenario:'A counselor fearing inadequacy accuses AI users of "feeling threatened and cheating."'},
    {name:'Illusory Pattern',cat:'Perception',icon:'üïµÔ∏è',tag:'Seeing plots',explain:'Detecting intent in unrelated events.',scenario:'A therapist believes companies are "programming AI to destroy counseling."'},
    {name:'Magical Thinking',cat:'Distortion',icon:'‚ú®',tag:'Mystical causality',explain:'Believing supernatural power.',scenario:'A counselor believes AI has mystical powers to read minds beyond what technology does.'},
    {name:'Echo Chamber',cat:'Social',icon:'üèùÔ∏è',tag:'Only hearing agreement',explain:'Information loops amplifying beliefs.',scenario:'A therapist asks AI to validate detached theories, disconnected from clinical reality.'},
    {name:'Illusory Superiority',cat:'Self',icon:'üèÜ',tag:'Uniquely chosen',explain:'Overestimating special status.',scenario:'A counselor believes AI "chose them" for special insights about therapy\'s future.'},
    {name:'Overconfidence',cat:'Judgment',icon:'üìà',tag:'Confidence outpaces accuracy',explain:'Subjective confidence exceeds feedback.',scenario:'A therapist stops peer supervision, believing only AI understands their views.'}
  ];

  var state = {deck:[],qIndex:0,score:0,attempts:0,total:0,current:null};

  function $(s){ return document.querySelector(s); }
  function shuffle(a){ return a.map(function(v){ return [Math.random(),v]; }).sort(function(x,y){ return x[0]-y[0]; }).map(function(x){ return x[1]; }); }

  function startGame(n){
    $('#welcome').style.display='none';
    $('#done').style.display='none';
    $('#game').style.display='grid';
    state.deck=shuffle(DATA.slice()).slice(0,Math.min(n,DATA.length));
    state.qIndex=0;state.score=0;state.attempts=0;state.total=state.deck.length;
    $('#total').textContent=state.total;
    $('#score').textContent=0;
    $('#acc').textContent='0%';
    renderQuestion();
  }

  function renderQuestion(){
    var item=state.deck[state.qIndex];
    state.current=item;

    var imgEl=$('#sImg');
    imgEl.style.display='none';

    $('#scenario').textContent=item.scenario;
    updateProgress();

    var pool=DATA.filter(function(x){ return x.name!==item.name; });
    var distractors=shuffle(pool).slice(0,4);
    var opts=shuffle([item].concat(distractors));
    var letters=['A','B','C','D','E'];

    $('#targets').innerHTML=opts.map(function(o,i){
      return '<div class="tile" data-name="'+o.name.replace(/"/g,'&quot;')+'">'+
        '<div class="letter">'+letters[i]+'</div>'+
        '<div><div class="tname">'+o.icon+' '+o.name+'</div>'+
        '<div class="tcat">'+o.cat+'</div>'+
        '<div class="tdesc">'+o.tag+'</div></div></div>';
    }).join('');

    setupDragAndTouch();
  }

  function setupDragAndTouch(){
    var src=$('#dragSrc');
    var touchTarget=null;

    src.addEventListener('touchstart',function(e){
      src.classList.add('dragging');
    },{passive:true});

    src.addEventListener('touchmove',function(e){
      var touch=e.touches[0];
      var el=document.elementFromPoint(touch.clientX,touch.clientY);
      
      var tiles=document.querySelectorAll('.tile');
      for(var i=0;i<tiles.length;i++) tiles[i].classList.remove('over');
      
      if(el && el.classList.contains('tile')){
        touchTarget=el;
        touchTarget.classList.add('over');
      }else if(el && el.closest('.tile')){
        touchTarget=el.closest('.tile');
        touchTarget.classList.add('over');
      }
    },{passive:true});

    src.addEventListener('touchend',function(){
      src.classList.remove('dragging');
      var tiles=document.querySelectorAll('.tile');
      for(var i=0;i<tiles.length;i++) tiles[i].classList.remove('over');
      
      if(touchTarget){
        handleChoice(touchTarget.getAttribute('data-name'));
        touchTarget=null;
      }
    });

    var allTiles=document.querySelectorAll('.tile');
    for(var i=0;i<allTiles.length;i++){
      (function(tile){
        tile.addEventListener('click',function(){ handleChoice(tile.getAttribute('data-name')); });
      })(allTiles[i]);
    }
  }

  function handleChoice(name){
    var correct=state.current;
    var ok=name===correct.name;
    state.attempts++;

    var tiles=document.querySelectorAll('.tile');
    for(var i=0;i<tiles.length;i++){
      var t=tiles[i];
      if(t.getAttribute('data-name')===name) t.classList.add(ok?'correct':'incorrect');
      t.style.pointerEvents='none';
    }

    showFeedback(ok,ok?'Correct ‚Äî '+correct.name:'Not quite. Answer: '+correct.name,correct.explain).then(function(){
      updateHUD();
      next();
    });
  }

  function updateHUD(){
    $('#score').textContent=state.score;
    var acc=state.attempts?Math.round((state.score/state.attempts)*100):0;
    $('#acc').textContent=acc+'%';
  }

  function updateProgress(){
    var pct=Math.round(((state.qIndex+1)/state.total)*100);
    var bar=$('#bar');
    bar.style.width=pct+'%';
    bar.textContent='Question '+(state.qIndex+1)+' of '+state.total;
  }

  function next(){
    state.qIndex++;
    if(state.qIndex<state.total) renderQuestion();
    else finish();
  }

  function finish(){
    $('#game').style.display='none';
    $('#done').style.display='grid';
    $('#finalScore').textContent=state.score+'/'+state.total;
    var acc=state.attempts?Math.round((state.score/state.attempts)*100):0;
    $('#finalAcc').textContent=acc+'%';
  }

  function showFeedback(ok,msg,explain){
    return new Promise(function(resolve){
      var o=$('#overlay');
      var box=$('#fbox');
      var close=$('#closex');
      var count=$('#count');
      
      box.className='fbox '+(ok?'correct':'incorrect');
      $('#ficon').textContent=ok?'‚úì':'‚úó';
      $('#fmsg').textContent=msg;
      $('#explain').textContent=explain||'';
      
      var remaining=8;
      count.textContent=remaining;
      o.classList.add('show');
      
      var tick=setInterval(function(){
        remaining--;
        if(remaining>=0) count.textContent=remaining;
      },1000);
      
      function cleanup(){
        clearInterval(tick);
        o.classList.remove('show');
        o.removeEventListener('click',outside);
        close.removeEventListener('click',cleanup);
        resolve();
      }
      
      function outside(e){ if(e.target===o) cleanup(); }
      
      o.addEventListener('click',outside);
      close.addEventListener('click',cleanup);
      
      if(ok) state.score++;
      setTimeout(cleanup,8000);
    });
  }

  function init(){
    var startQuick=$('#startQuick');
    var startFull=$('#startFull');
    var playAgain=$('#playAgain');
    
    if(startQuick) startQuick.addEventListener('click',function(){ startGame(10); });
    if(startFull) startFull.addEventListener('click',function(){ startGame(DATA.length); });
    if(playAgain) playAgain.addEventListener('click',function(){ window.location.reload(); });
  }

  if(document.readyState==='loading'){
    document.addEventListener('DOMContentLoaded',init);
  }else{
    init();
  }
})();
</script>
</body>
</html>
